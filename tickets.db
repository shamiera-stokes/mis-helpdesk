import sqlite3
import pandas as pd
import random
import datetime

# Create the database
conn = sqlite3.connect("tickets.db")
cursor = conn.cursor()

# Drop old table if it exists
cursor.execute("DROP TABLE IF EXISTS tickets")

# Create correct table
cursor.execute("""
CREATE TABLE tickets (
    ticket_id INTEGER PRIMARY KEY AUTOINCREMENT,
    category TEXT,
    priority TEXT,
    status TEXT,
    created_at TEXT,
    closed_at TEXT,
    assigned_to TEXT,
    description TEXT
)
""")

# Fake data options
categories = ["Hardware", "Software", "Network", "Account", "Email", "Printer"]
priorities = ["Low", "Medium", "High", "Critical"]
statuses = ["Open", "In Progress", "Closed"]
agents = ["Jordan", "Kim", "Taylor", "Morgan", "Alex", "Riley"]

# Generate ~600 fake tickets
rows = []
for i in range(600):
    created = datetime.datetime(2024, 1, 1) + datetime.timedelta(days=random.randint(0, 365))
    closed = created + datetime.timedelta(days=random.randint(0, 10)) if random.random() > 0.3 else None
    
    rows.append((
        random.choice(categories),
        random.choice(priorities),
        random.choice(statuses),
        created.strftime("%Y-%m-%d"),
        closed.strftime("%Y-%m-%d") if closed else None,
        random.choice(agents),
        "Auto-generated test ticket."
    ))

# Insert
cursor.executemany("""
INSERT INTO tickets (category, priority, status, created_at, closed_at, assigned_to, description)
VALUES (?, ?, ?, ?, ?, ?, ?)
""", rows)

conn.commit()
conn.close()

print("DONE â€” tickets.db created with 600 rows!")
